apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: atlantis
  namespace: atlantis
spec:
  routes:
  - kind: Rule
    match: Host(`atlantis.<LOCAL_DNS>`)
    services:
    - name: atlantis
      port: 80
  tls:
    secretName: atlantis-tls
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  name: redirect-to-https
  namespace: atlantis
spec:
  redirectScheme:
    scheme: https
    permanent: true
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRouteTCP
metadata:
  name: atlantis
spec:
  entryPoints:                  
    - tcpAtlantis
  routes:                       
  - match: HostSNI(`*`)         
    priority: 10                
    middlewares:
    - name: atlantistcp       
      namespace: atlantis      
    services:                 
    - name: foo               
      port: 8080              
      weight: 10              
      terminationDelay: 400   
      proxyProtocol:          
        version: 1
  tls:
    secretName: atlantis-tls
